'use strict';var _createClass=function(){function a(b,c){for(var g,d=0;d<c.length;d++)g=c[d],g.enumerable=g.enumerable||!1,g.configurable=!0,'value'in g&&(g.writable=!0),Object.defineProperty(b,g.key,g)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_react=require('react'),_react2=_interopRequireDefault(_react),_util=require('./util');Object.defineProperty(exports,'__esModule',{value:!0}),exports.Input=exports.Form=void 0;function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var Input=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.state={value:'',isValid:!0,rules:c.rules,errors:{},feedbackClass:'',name:d.props.props.name?d.props.props.name:d.props.key},d.handleChange=d.handleChange.bind(d),d.handleBlur=d.handleBlur.bind(d),d.handleValidation=d.handleValidation.bind(d),d.checkForErrors=d.checkForErrors.bind(d),d}return _inherits(b,a),_createClass(b,[{key:'componentDidMount',value:function componentDidMount(){this.checkForErrors(this.state.name,this.state.value),'function'==typeof this.props.syncFormState&&this.props.syncFormState(this.state.name,this.state.value,this.state.errors)}},{key:'checkForErrors',value:function checkForErrors(c,d){var g,h=this.state;if(c&&(g=_util.Validator.make(_defineProperty({},c,d),_defineProperty({},c,this.state.rules))),g.fails()){var j=g.getErrors();h.isValid=!1,h.errors=j}return g.passes()&&(h.errors={},h.isValid=!0),h}},{key:'handleValidation',value:function handleValidation(c,d){var g=this.checkForErrors(c,d);return g.isValid?(g.feedbackClass=this.props.successClass,g.isValid=!0):(g.isValid=!1,g.feedbackClass=this.props.errorClass),this.setState(g),g}},{key:'handleChange',value:function handleChange(c){var d=this.state.name,g=c.target.value;this.props.props.value=g;var h=this.handleValidation(d,g);h.value=g,'function'==typeof this.props.onChange&&this.props.onChange(c),this.setState(h)}},{key:'handleBlur',value:function handleBlur(c){'function'==typeof this.props.onBlur&&this.props.onBlur(c),'function'==typeof this.props.syncFormState&&this.props.syncFormState(this.state.name,this.state.value,this.state.errors)}},{key:'render',value:function render(){var j={className:this.props.InputWrapClass+' '+this.state.feedbackClass},k=this.props.label.props,l=Object.assign(this.props.props,{value:this.props.props.value?this.props.props.value:'',onChange:this.handleChange,onBlur:this.handleBlur,onSubmit:this.handleSubmit});if(this.props.help)var c=this.props.help.props,d=this.props.help.text;if(this.props.error)var g=this.props.error.props,h='auto'===this.props.error.text?this.state.errors[this.state.name]:this.props.error.text;return _react2.default.createElement('div',j,_react2.default.createElement('label',k,this.props.label.text),_react2.default.createElement('input',l,null),this.props.help?_react2.default.createElement('span',c,d):null,this.state.isValid?null:_react2.default.createElement('span',g,h))}}]),b}(_react.Component),Form=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.state={isValid:!1,formData:{},errors:{},validate:!1,updateKey:Math.random()},d.stateClone=d.state,d.syncFormState=d.syncFormState.bind(d),d.handleSubmit=d.handleSubmit.bind(d),d}return _inherits(b,a),_createClass(b,[{key:'componentDidMount',value:function componentDidMount(){this.props.debug&&console.log('componentDidMount',this.props)}},{key:'syncFormState',value:function syncFormState(c,d,g){var h=this.stateClone;h.formData[c]=d,0===Object.getOwnPropertyNames(g).length?delete h.errors[c]:h.errors=Object.assign(h.errors,g),this.stateClone=h,this.props.debug&&console.log('syncFormState',h)}},{key:'handleSubmit',value:function handleSubmit(c){c.preventDefault();var d=this.stateClone,g=Object.getOwnPropertyNames(d.errors).length,h=!1;for(var j in d.formData)if(d.formData.hasOwnProperty(j)&&0===d.formData[j].length){h=!0;break}h||g?(d.isValid=!1,d.validate=!0):(d.validate=!1,d.isValid=!0),d.isValid&&this.setState(d),'function'==typeof this.props.OnSubmit&&this.props.OnSubmit(d),this.props.debug&&console.log('handleSubmit',d)}},{key:'render',value:function render(){var g=this,c=this.props,d={text:c.btn?c.btn.text:'Submit',props:c.btn?c.btn.props:{type:'submit',className:'btn btn-defualt'}};return _react2.default.createElement('form',Object.assign({onSubmit:this.handleSubmit},c),c.fields.map(function(h){return _react2.default.createElement(Input,Object.assign(h,{syncFormState:g.syncFormState},{key:Math.random()}),null)}),_react2.default.createElement('button',c.btn.props,c.btn.text))}}]),b}(_react.Component);exports.Form=Form,exports.Input=Input;